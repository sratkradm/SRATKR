<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="https://kbwljjyzlmaclcrlmptg.supabase.co/storage/v1/object/public/images/jais.png">
    <link rel="icon" type="image/png" href="URL_LOGO_ANDA"> 
    <title>Takwim Persekolahan - SRA Taman Kajang Raya</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sra: { primary: '#004D40', accent: '#FFC107', light: '#F5F5F5', dark: '#1F2937' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    
    <style>
        /* Style untuk kotak kalendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e5e7eb; /* Garis pemisah */
            border: 1px solid #e5e7eb;
        }
        .calendar-day {
            background-color: white;
            min-height: 100px;
            padding: 0.5rem;
            position: relative;
        }
        .calendar-day-header {
            background-color: #004D40;
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: bold;
            font-size: 0.9rem;
        }
        /* Mobile adjustment */
        @media (max-width: 640px) {
            .calendar-day { min-height: 80px; font-size: 0.8rem; }
            .event-badge { font-size: 0.65rem; padding: 2px; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 flex flex-col min-h-screen">

    <!-- HEADER -->
    <header class="bg-sra-primary text-white sticky top-0 z-50 shadow-lg border-b-4 border-sra-accent">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="/" class="flex items-center space-x-3">
                <!-- GANTIKAN URL LOGO ANDA DI SINI -->
                <img src="https://kbwljjyzlmaclcrlmptg.supabase.co/storage/v1/object/public/images/jais.png" alt="Logo Sekolah" class="w-12 h-12 rounded-full object-cover border-2 border-sra-accent bg-white">
                <h1 class="text-md font-bold uppercase tracking-wide">SRA Taman Kajang Raya</h1>
            </a>
            <a href="/" class="text-sm font-bold hover:text-sra-accent"><i class="fas fa-home mr-2"></i> Utama</a>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="flex-grow container mx-auto px-4 py-8">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-sra-primary">Takwim Persekolahan</h1>
            <p class="text-gray-600 mt-2">Jadual acara, peperiksaan dan cuti sekolah</p>
        </div>

        <!-- KALENDAR CONTAINER -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden max-w-5xl mx-auto">
            
            <!-- Controls (Bulan/Tahun) -->
            <div class="flex items-center justify-between p-6 bg-sra-light border-b">
                <button onclick="changeMonth(-1)" class="p-2 rounded-full hover:bg-gray-200 transition text-sra-primary">
                    <i class="fas fa-chevron-left fa-lg"></i>
                </button>
                
                <h2 id="current-month-year" class="text-2xl font-bold text-gray-800 uppercase">
                    <!-- Januari 2025 -->
                </h2>
                
                <button onclick="changeMonth(1)" class="p-2 rounded-full hover:bg-gray-200 transition text-sra-primary">
                    <i class="fas fa-chevron-right fa-lg"></i>
                </button>
            </div>

            <!-- Petunjuk Warna (Legend) -->
            <div class="flex flex-wrap gap-4 px-6 py-3 text-sm border-b bg-white">
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-100 border border-red-500 mr-2"></span> Cuti</div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-yellow-100 border border-yellow-500 mr-2"></span> Peperiksaan</div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-green-100 border border-green-500 mr-2"></span> Program Sekolah</div>
                <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-100 border border-blue-500 mr-2"></span> Lain-lain</div>
            </div>

            <!-- Grid Kalendar -->
            <div class="calendar-grid" id="calendar-body">
                <!-- Header Hari (Ahad - Sabtu) -->
                <div class="calendar-day-header">AHAD</div>
                <div class="calendar-day-header">ISNIN</div>
                <div class="calendar-day-header">SELASA</div>
                <div class="calendar-day-header">RABU</div>
                <div class="calendar-day-header">KHAMIS</div>
                <div class="calendar-day-header">JUMAAT</div>
                <div class="calendar-day-header">SABTU</div>

                <!-- Tarikh akan dijana oleh JS di sini -->
            </div>
        </div>

    </main>

    <!-- FOOTER -->
    <footer class="bg-sra-primary text-gray-100 border-t-4 border-sra-accent py-6 text-center text-sm">
        <p>&copy; 2025 SRA Taman Kajang Raya.</p>
    </footer>

    <!-- LOGIK KALENDAR -->
    <script>
        let currentDate = new Date();
        let allEvents = [];

        document.addEventListener('DOMContentLoaded', async () => {
            // 1. Ambil data dari Supabase
            try {
                const res = await fetch('/api/calendar');
                const data = await res.json();
                allEvents = data;
                renderCalendar();
            } catch (err) {
                console.error("Gagal ambil event:", err);
                // Render kalendar kosong jika error
                renderCalendar(); 
            }
        });

        function renderCalendar() {
            const monthYearEl = document.getElementById('current-month-year');
            const calendarBody = document.getElementById('calendar-body');
            
            // Set locale Melayu untuk nama bulan
            const monthName = currentDate.toLocaleDateString('ms-MY', { month: 'long', year: 'numeric' });
            monthYearEl.innerText = monthName;

            // Bersihkan grid (kecuali header hari)
            // Kita simpan 7 div pertama (header) dan buang selebihnya
            const headers = Array.from(document.querySelectorAll('.calendar-day-header'));
            calendarBody.innerHTML = '';
            headers.forEach(h => calendarBody.appendChild(h));

            // Logik Tarikh
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            const firstDayIndex = new Date(year, month, 1).getDay(); // 0 = Ahad
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Kotak Kosong (Sebelum 1hb)
            for (let i = 0; i < firstDayIndex; i++) {
                const emptyDiv = document.createElement('div');
                emptyDiv.classList.add('bg-gray-50'); // Kelabu cair
                calendarBody.appendChild(emptyDiv);
            }

            // Kotak Tarikh (1 - 31)
            for (let day = 1; day <= daysInMonth; day++) {
                const dayDiv = document.createElement('div');
                dayDiv.classList.add('calendar-day', 'hover:bg-gray-50', 'transition');
                
                // Highlight Hari Ini
                const today = new Date();
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayDiv.classList.add('bg-blue-50'); // Highlight biru muda
                    dayDiv.innerHTML = `<span class="inline-flex items-center justify-center w-7 h-7 bg-sra-primary text-white rounded-full font-bold text-sm mb-1">${day}</span>`;
                } else {
                    dayDiv.innerHTML = `<span class="text-gray-700 font-semibold text-sm block mb-1">${day}</span>`;
                }

                // Cari Event untuk tarikh ini
                // Format tarikh JS ke YYYY-MM-DD untuk bandingkan dengan DB
                const currentDayStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;

                const daysEvents = allEvents.filter(event => {
                    return currentDayStr >= event.start_date && currentDayStr <= event.end_date;
                });

                // Masukkan Event ke dalam kotak
                daysEvents.forEach(evt => {
                    const eventEl = document.createElement('div');
                    
                    // Style Warna ikut Kategori
                    let colorClass = 'bg-blue-100 text-blue-800 border-blue-200'; // Default
                    if (evt.category === 'cuti') colorClass = 'bg-red-100 text-red-800 border-red-200';
                    if (evt.category === 'exam') colorClass = 'bg-yellow-100 text-yellow-800 border-yellow-200';
                    if (evt.category === 'program') colorClass = 'bg-green-100 text-green-800 border-green-200';

                    eventEl.className = `event-badge mt-1 px-1.5 py-0.5 rounded text-xs border ${colorClass} truncate cursor-pointer`;
                    eventEl.innerText = evt.title;
                    eventEl.title = evt.title; // Tooltip bila hover
                    
                    // Mobile: potong nama panjang
                    eventEl.onclick = () => alert(`${evt.title}\n\nTarikh: ${evt.start_date} hingga ${evt.end_date}\nInfo: ${evt.description || '-'}`);

                    dayDiv.appendChild(eventEl);
                });

                calendarBody.appendChild(dayDiv);
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        }
    </script>
</body>
</html>
